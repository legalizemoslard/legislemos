{"version":3,"sources":["webpack:///./app/components/InitiativeCard/messages.ts","webpack:///./app/resources/GetInitiativesPermissions.tsx","webpack:///./app/resources/GetInitiative.tsx","webpack:///./app/components/UI/ProgressBar/warning_pattern.svg","webpack:///./app/resources/GetInitiativeStatus.tsx","webpack:///./app/components/UI/ProgressBar/index.tsx","webpack:///./app/hooks/useInitiativesPermissions.ts","webpack:///./app/services/initiativeImages.ts","webpack:///./app/components/InitiativeCard/VoteIndicator.tsx"],"names":["defineMessages","xComments","id","defaultMessage","xVotesOfY","children","action","GetInitiative","props","state","initiative","undefined","this","slug","resetOnChange","inputProps$","BehaviorSubject","subscriptions","pipe","distinctUntilChanged","prev","next","tap","setState","switchMap","isString","initiativeByIdStream","observable","initiativeBySlugStream","of","subscribe","isNilOrError","data","forEach","subscription","unsubscribe","React","Component","GetInitiativeStatus","initiativeStatus","filter","initiativeStatusStream","Container","styled","div","ProgressBarOuter","theme","borderRadius","background","ProgressBarInner","color","progress","event","unobserve","isIntersecting","visible","bgColor","className","bgShaded","onChange","handleIntersection","warningPattern","clamp","PureComponent","useState","actionPermission","setActionPermission","useEffect","combineLatest","getInitiativeActionDescriptors","currentAppConfigurationStream","authUserStream","actionDescriptors","tenant","authUser","actionDescriptor","enabled","show","disabledReason","disabled_reason","initiativeId","imageId","apiEndpoint","API_PATH","streams","get","streamParams","delete","base64","ordering","bodyData","image","add","initiativeImage","fetch","StatusBadge","fontSizes","small","BadgeLabel","AnsweredBadgeIcon","Icon","colors","clGreenSuccess","AnsweredStatusBadge","clGreenSuccessBackground","IneligibleBadgeIcon","clGreyOnGreyBackground","IneligibleStatusBadge","lightGreyishBlue","CustomStatusBadge","StyledProgressBar","ProgressBar","VoteCounter","VoteText","mediumGrey","colorMain","VoteIcon","label","ExpiredText","ExpiredIcon","VoteIndicator","statusCode","attributes","code","voteCount","upvotes_count","voteLimit","name","ariaHidden","ScreenReaderOnly","FormattedMessage","messages","values","xVotes","votingThreshold","value","title_multiloc","Data","adopt","render","VoteIndicatorWithHOCs","withTheme","inputProps","dataProps"],"mappings":"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","file":"15.25cf10e174b0471f756a.chunk.js","sourcesContent":["import { defineMessages } from 'react-intl';\n\nexport default defineMessages({\n  xComments: {\n    id: 'app.components.InitiativeCard.xComments',\n    defaultMessage:\n      '{commentsCount, plural, =0 {no comments} one {1 comment} other {# comments}}',\n  },\n  xVotesOfY: {\n    id: 'app.components.InitiativeCard.xVotesOfY',\n    defaultMessage:\n      '{xVotes, plural, =0 {no votes} one {1 vote} other {# votes}} out of {votingThreshold}',\n  },\n});\n","import { IInitiativeAction } from 'services/initiatives';\nimport { ActionPermission } from 'services/actionTakingRules';\nimport useInitiativesPermissions, {\n  IInitiativeDisabledReason,\n} from 'hooks/useInitiativesPermissions';\n\ninterface InputProps {}\n\ntype children = (\n  renderProps: GetInitiativesPermissionsChildProps\n) => JSX.Element | null;\n\ninterface Props extends InputProps {\n  children?: children;\n  action: IInitiativeAction;\n}\n\nexport type GetInitiativesPermissionsChildProps =\n  | ActionPermission<IInitiativeDisabledReason>\n  | undefined;\n\nexport default ({ children, action }: Props) => {\n  const initiativesPermissions = useInitiativesPermissions(action);\n  return (children as children)(initiativesPermissions);\n};\n","import React from 'react';\nimport { isString } from 'lodash-es';\nimport { isNilOrError } from 'utils/helperUtils';\nimport { Subscription, BehaviorSubject, of } from 'rxjs';\nimport { distinctUntilChanged, switchMap, tap } from 'rxjs/operators';\nimport shallowCompare from 'utils/shallowCompare';\nimport {\n  IInitiativeData,\n  initiativeByIdStream,\n  initiativeBySlugStream,\n} from 'services/initiatives';\n\ninterface InputProps {\n  id?: string | null;\n  slug?: string | null;\n  resetOnChange?: boolean;\n}\n\ntype children = (renderProps: GetInitiativeChildProps) => JSX.Element | null;\n\ninterface Props extends InputProps {\n  children?: children;\n}\n\ninterface State {\n  initiative: IInitiativeData | undefined | null | Error;\n}\n\nexport type GetInitiativeChildProps =\n  | IInitiativeData\n  | undefined\n  | null\n  | Error;\n\nexport default class GetInitiative extends React.Component<Props, State> {\n  private inputProps$: BehaviorSubject<InputProps>;\n  private subscriptions: Subscription[];\n\n  static defaultProps = {\n    resetOnChange: true,\n  };\n\n  constructor(props: Props) {\n    super(props);\n    this.state = {\n      initiative: undefined,\n    };\n  }\n\n  componentDidMount() {\n    const { id, slug, resetOnChange } = this.props;\n\n    this.inputProps$ = new BehaviorSubject({ id, slug });\n\n    this.subscriptions = [\n      this.inputProps$\n        .pipe(\n          distinctUntilChanged((prev, next) => shallowCompare(prev, next)),\n          tap(() => resetOnChange && this.setState({ initiative: undefined })),\n          switchMap(({ id, slug }) => {\n            if (isString(id)) {\n              return initiativeByIdStream(id).observable;\n            } else if (isString(slug)) {\n              return initiativeBySlugStream(slug).observable;\n            }\n\n            return of(null);\n          })\n        )\n        .subscribe((initiative) => {\n          this.setState({\n            initiative: !isNilOrError(initiative)\n              ? initiative.data\n              : initiative,\n          });\n        }),\n    ];\n  }\n\n  componentDidUpdate() {\n    const { id, slug } = this.props;\n    this.inputProps$.next({ id, slug });\n  }\n\n  componentWillUnmount() {\n    this.subscriptions.forEach((subscription) => subscription.unsubscribe());\n  }\n\n  render() {\n    const { children } = this.props;\n    const { initiative } = this.state;\n    return (children as children)(initiative);\n  }\n}\n","export default \"data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIj8+CjwhRE9DVFlQRSBzdmcgUFVCTElDICItLy9XM0MvL0RURCBTVkcgMS4wLy9FTiIKCSJodHRwOi8vd3d3LnczLm9yZy9UUi8yMDAxL1JFQy1TVkctMjAwMTA5MDQvRFREL3N2ZzEwLmR0ZCI+CjxzdmcgaGVpZ2h0PSIyMCIgd2lkdGg9IjIwIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPgogIDxkZWZzPgogICAgPHBhdHRlcm4gaGVpZ2h0PSIyMCIgaWQ9Indhcm5pbmctMSIgcGF0dGVybkNvbnRlbnRVbml0cz0idXNlclNwYWNlT25Vc2UiIHBhdHRlcm5Vbml0cz0idXNlclNwYWNlT25Vc2UiIHdpZHRoPSIyMCI+CiAgICAgIDxwb2x5Z29uIHBvaW50cz0iMCwxMCAwLDAgMTAsMCIgc3R5bGU9ImZpbGw6cmdiYSgwLDAsMCwwKTsiLz4KICAgICAgPHBvbHlnb24gcG9pbnRzPSIwLDIwIDIwLDAgMTAsMCAwLDEwIiBzdHlsZT0iZmlsbDpyZ2JhKDAsMCwwLDAuMSk7Ii8+CiAgICAgIDxwb2x5Z29uIHBvaW50cz0iMTAsMjAgMjAsMTAgMjAsMjAiIHN0eWxlPSJmaWxsOnJnYmEoMCwwLDAsMC4xKTsiLz4KICAgICAgPHBvbHlnb24gcG9pbnRzPSIwLDIwIDEwLDIwIDIwLDEwIDIwLDAiIHN0eWxlPSJmaWxsOnJnYmEoMCwwLDAsMCk7Ii8+CiAgICA8L3BhdHRlcm4+CiAgPC9kZWZzPgogIDxyZWN0IGZpbGw9InVybCgjd2FybmluZy0xKSIgaGVpZ2h0PSIyMCIgd2lkdGg9IjIwIiB4PSIwIiB5PSIwIi8+Cjwvc3ZnPgo=\"","import React from 'react';\nimport { BehaviorSubject, Subscription, of } from 'rxjs';\nimport { distinctUntilChanged, switchMap, filter } from 'rxjs/operators';\nimport shallowCompare from 'utils/shallowCompare';\nimport {\n  IInitiativeStatusData,\n  initiativeStatusStream,\n} from 'services/initiativeStatuses';\nimport { isString } from 'lodash-es';\nimport { isNilOrError } from 'utils/helperUtils';\n\ninterface InputProps {\n  id: string | null;\n}\n\ntype children = (\n  renderProps: GetInitiativeStatusChildProps\n) => JSX.Element | null;\n\ninterface Props extends InputProps {\n  children?: children;\n}\n\ninterface State {\n  initiativeStatus: IInitiativeStatusData | undefined | null;\n}\n\nexport type GetInitiativeStatusChildProps =\n  | IInitiativeStatusData\n  | undefined\n  | null;\n\nexport default class GetInitiativeStatus extends React.Component<Props, State> {\n  private inputProps$: BehaviorSubject<InputProps>;\n  private subscriptions: Subscription[];\n\n  constructor(props: Props) {\n    super(props);\n    this.state = {\n      initiativeStatus: undefined,\n    };\n  }\n\n  componentDidMount() {\n    const { id } = this.props;\n\n    this.inputProps$ = new BehaviorSubject({ id });\n\n    this.subscriptions = [\n      this.inputProps$\n        .pipe(\n          distinctUntilChanged((prev, next) => shallowCompare(prev, next)),\n          filter(({ id }) => isString(id)),\n          switchMap(({ id }: { id: string }) => {\n            if (isString(id)) {\n              return initiativeStatusStream(id).observable;\n            }\n\n            return of(null);\n          })\n        )\n        .subscribe((initiativeStatus) =>\n          this.setState({\n            initiativeStatus: !isNilOrError(initiativeStatus)\n              ? initiativeStatus.data\n              : null,\n          })\n        ),\n    ];\n  }\n\n  componentDidUpdate() {\n    const { id } = this.props;\n    this.inputProps$.next({ id });\n  }\n\n  componentWillUnmount() {\n    this.subscriptions.forEach((subscription) => subscription.unsubscribe());\n  }\n\n  render() {\n    const { children } = this.props;\n    const { initiativeStatus } = this.state;\n    return (children as children)(initiativeStatus);\n  }\n}\n","import React, { PureComponent } from 'react';\nimport styled from 'styled-components';\nimport { clamp } from 'lodash-es';\nimport Observer from '@researchgate/react-intersection-observer';\nimport warningPattern from './warning_pattern.svg';\n\nconst Container = styled.div``;\n\nconst ProgressBarOuter = styled.div<{ background: string }>`\n  width: 100%;\n  height: 100%;\n  border-radius: ${(props: any) => props.theme.borderRadius};\n  background: ${(props) => props.background};\n`;\n\nconst ProgressBarInner: any = styled.div<{ progress: number; color: string }>`\n  width: 0px;\n  height: 100%;\n  border-radius: ${(props: any) => props.theme.borderRadius};\n  background: ${(props) => props.color};\n  transition: width 1000ms cubic-bezier(0.19, 1, 0.22, 1);\n  will-change: width;\n\n  &.visible {\n    width: ${(props) => props.progress * 100}%;\n  }\n`;\n\ninterface Props {\n  /** Number between 0 and 1 */\n  progress: number;\n  color: string;\n  bgColor: string;\n  /** Whether the background has a diagonal stripes pattern, defaults to false */\n  bgShaded?: boolean;\n  className?: string;\n}\n\ninterface State {\n  visible: boolean;\n}\n\nclass ProgressBar extends PureComponent<Props, State> {\n  constructor(props) {\n    super(props);\n    this.state = {\n      visible: false,\n    };\n  }\n\n  handleIntersection = (\n    event: IntersectionObserverEntry,\n    unobserve: () => void\n  ) => {\n    if (event.isIntersecting) {\n      this.setState({ visible: true });\n      unobserve();\n    }\n  };\n\n  render() {\n    const { progress, color, bgColor, className, bgShaded } = this.props;\n    const { visible } = this.state;\n\n    return (\n      <Container className={className} aria-hidden>\n        <Observer onChange={this.handleIntersection}>\n          <ProgressBarOuter\n            background={\n              bgShaded === true ? `url(\"${warningPattern}\")` : bgColor\n            }\n          >\n            <ProgressBarInner\n              progress={clamp(progress, 0, 1)}\n              className={visible ? 'visible' : ''}\n              color={color}\n            />\n          </ProgressBarOuter>\n        </Observer>\n      </Container>\n    );\n  }\n}\n\nexport default ProgressBar;\n","import { useState, useEffect } from 'react';\nimport {\n  getInitiativeActionDescriptors,\n  IInitiativeAction,\n} from 'services/initiatives';\nimport { isNilOrError } from 'utils/helperUtils';\nimport { ActionPermission } from 'services/actionTakingRules';\nimport { currentAppConfigurationStream } from 'services/appConfiguration';\nimport { authUserStream } from 'services/auth';\nimport { combineLatest } from 'rxjs';\n\nexport type IInitiativeDisabledReason = 'notPermitted';\n\nexport type IPreliminaryAction =\n  | 'sign_in_up'\n  | 'verify'\n  | 'sign_in_up_and_verify';\n\nexport default function useInitiativesPermissions(action: IInitiativeAction) {\n  const [actionPermission, setActionPermission] = useState<\n    ActionPermission<IInitiativeDisabledReason> | null | undefined\n  >(undefined);\n\n  useEffect(() => {\n    const subscription = combineLatest(\n      getInitiativeActionDescriptors().observable,\n      currentAppConfigurationStream().observable,\n      authUserStream().observable\n    ).subscribe(([actionDescriptors, tenant, authUser]) => {\n      if (!isNilOrError(tenant) && !isNilOrError(actionDescriptors)) {\n        const actionDescriptor = actionDescriptors[action];\n\n        if (actionDescriptor.enabled) {\n          setActionPermission({\n            show: true,\n            enabled: true,\n            disabledReason: null,\n            action: null,\n          });\n        } else {\n          switch (actionDescriptor.disabled_reason) {\n            case 'not_verified':\n              if (isNilOrError(authUser)) {\n                setActionPermission({\n                  show: true,\n                  enabled: 'maybe',\n                  disabledReason: null,\n                  action: 'sign_in_up_and_verify',\n                });\n              } else {\n                setActionPermission({\n                  show: true,\n                  enabled: 'maybe',\n                  disabledReason: null,\n                  action: 'verify',\n                });\n              }\n              break;\n            case 'not_signed_in':\n              setActionPermission({\n                show: true,\n                enabled: 'maybe',\n                disabledReason: null,\n                action: 'sign_in_up',\n              });\n              break;\n            default:\n              setActionPermission({\n                show: true,\n                enabled: false,\n                disabledReason: 'notPermitted',\n                action: null,\n              });\n          }\n        }\n      }\n    });\n\n    return () => subscription.unsubscribe();\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, []);\n\n  return actionPermission as ActionPermission<IInitiativeDisabledReason>;\n}\n","import { API_PATH } from 'containers/App/constants';\nimport streams, { IStreamParams } from 'utils/streams';\nimport { initiativeByIdStream } from 'services/initiatives';\nimport { ImageSizes } from 'typings';\n\nexport interface IInitiativeImageData {\n  id: string;\n  type: string;\n  attributes: {\n    versions: ImageSizes;\n    ordering: number;\n    created_at: string;\n    updated_at: string;\n  };\n}\n\nexport interface IInitiativeImage {\n  data: IInitiativeImageData;\n}\n\nexport interface IInitiativeImages {\n  data: IInitiativeImageData[];\n}\n\nexport function initiativeImageStream(initiativeId: string, imageId: string) {\n  const apiEndpoint = `${API_PATH}/initiatives/${initiativeId}/images/${imageId}`;\n  return streams.get<IInitiativeImage>({ apiEndpoint });\n}\n\nexport function initiativeImagesStream(\n  initiativeId: string,\n  streamParams: IStreamParams | null = null\n) {\n  const apiEndpoint = `${API_PATH}/initiatives/${initiativeId}/images`;\n  return streams.get<IInitiativeImages>({ apiEndpoint, ...streamParams });\n}\n\nexport function deleteInitiativeImage(initiativeId: string, imageId: string) {\n  return streams.delete(\n    `${API_PATH}/initiatives/${initiativeId}/images/${imageId}`,\n    imageId\n  );\n}\n\nexport async function addInitiativeImage(\n  initiativeId: string,\n  base64: string,\n  ordering: number | null = null\n) {\n  const apiEndpoint = `${API_PATH}/initiatives/${initiativeId}/images`;\n  const bodyData = {\n    image: {\n      ordering,\n      image: base64,\n    },\n  };\n\n  const initiativeImage = await streams.add<IInitiativeImage>(\n    apiEndpoint,\n    bodyData\n  );\n  await initiativeByIdStream(initiativeId).fetch();\n  return initiativeImage;\n}\n","import React, { PureComponent } from 'react';\nimport styled, { withTheme } from 'styled-components';\n\nimport GetAppConfiguration, {\n  GetAppConfigurationChildProps,\n} from 'resources/GetAppConfiguration';\nimport GetInitiative, {\n  GetInitiativeChildProps,\n} from 'resources/GetInitiative';\nimport GetInitiativeStatus, {\n  GetInitiativeStatusChildProps,\n} from 'resources/GetInitiativeStatus';\n\nimport { Icon } from 'cl2-component-library';\nimport ProgressBar from 'components/UI/ProgressBar';\n\nimport { adopt } from 'react-adopt';\nimport { isNilOrError } from 'utils/helperUtils';\n\nimport { fontSizes, colors } from 'utils/styleUtils';\nimport { ScreenReaderOnly } from 'utils/a11y';\n\nimport { FormattedMessage } from 'utils/cl-intl';\nimport messages from './messages';\n\nimport T from 'components/T';\nimport { get } from 'lodash-es';\n\nconst Container = styled.div``;\n\nconst StatusBadge = styled.div<{ color: string }>`\n  font-size: ${fontSizes.small}px;\n  line-height: 18px;\n  border-radius: ${(props: any) => props.theme.borderRadius};\n  padding: 8px 12px;\n  font-weight: 400;\n  background-color: ${(props) => props.color};\n  display: flex;\n  align-items: center;\n`;\n\nconst BadgeLabel = styled.div`\n  &:first-letter {\n    text-transform: uppercase;\n  }\n`;\n\nconst AnsweredBadgeIcon = styled(Icon)`\n  width: 1.6em;\n  height: 1.6em;\n  fill: ${colors.clGreenSuccess};\n  padding-right: 7px;\n`;\n\nconst AnsweredStatusBadge = styled(StatusBadge)`\n  background-color: ${colors.clGreenSuccessBackground};\n  color: ${colors.clGreenSuccess};\n`;\n\nconst IneligibleBadgeIcon = styled(Icon)`\n  width: 1.6em;\n  height: 1.6em;\n  fill: ${colors.clGreyOnGreyBackground};\n  padding-right: 7px;\n`;\n\nconst IneligibleStatusBadge = styled(StatusBadge)`\n  background-color: ${colors.lightGreyishBlue};\n  color: ${colors.clGreyOnGreyBackground};\n`;\n\nconst CustomStatusBadge = styled(StatusBadge)`\n  color: ${colors.clGreyOnGreyBackground};\n`;\n\nconst StyledProgressBar = styled(ProgressBar)`\n  height: 9px;\n  width: 120px;\n`;\n\nconst VoteCounter = styled.div`\n  display: flex;\n  align-items: center;\n  padding-bottom: 5px;\n`;\n\nconst VoteText = styled.div`\n  color: ${colors.mediumGrey};\n  font-size: ${fontSizes.small}px;\n\n  b {\n    font-weight: 600;\n    color: ${({ theme }) => theme.colorMain};\n  }\n\n  span.division-bar {\n    padding: 0 4px;\n  }\n`;\n\nconst VoteIcon = styled(Icon)`\n  fill: ${colors.label};\n  width: 16px;\n  height: 16px;\n  margin-top: -4px;\n  margin-right: 10px;\n`;\n\nconst ExpiredText = styled.div`\n  display: flex;\n  align-items: center;\n  font-size: ${fontSizes.small}px;\n  text-transform: capitalize;\n  padding-bottom: 5px;\n  color: ${colors.label};\n`;\n\nconst ExpiredIcon = styled(Icon)`\n  path {\n    fill: ${colors.clGreyOnGreyBackground};\n  }\n  width: 14px;\n  height: 14px;\n  margin: 0 4px 2px 0;\n`;\n\ninterface InputProps {\n  initiativeId: string;\n}\n\ninterface DataProps {\n  tenant: GetAppConfigurationChildProps;\n  initiative: GetInitiativeChildProps;\n  initiativeStatus: GetInitiativeStatusChildProps;\n}\n\ninterface Props extends InputProps, DataProps {}\n\nclass VoteIndicator extends PureComponent<Props & { theme: any }> {\n  render() {\n    const { initiative, initiativeStatus, theme, tenant } = this.props;\n    if (isNilOrError(initiative) || isNilOrError(initiativeStatus)) return null;\n\n    const statusCode = initiativeStatus.attributes.code;\n    const voteCount = initiative.attributes.upvotes_count;\n    const voteLimit: number = get(\n      tenant,\n      'attributes.settings.initiatives.voting_threshold',\n      1\n    );\n\n    return (\n      <Container className=\"e2e-initiative-card-vote-indicator\">\n        {statusCode === 'proposed' && (\n          <div>\n            <VoteCounter>\n              <VoteIcon name=\"upvote\" ariaHidden />\n              <VoteText aria-hidden>\n                <b className=\"e2e-initiative-card-vote-count\">{voteCount}</b>\n                <span className=\"division-bar\">/</span>\n                {voteLimit}\n              </VoteText>\n            </VoteCounter>\n            <StyledProgressBar\n              progress={voteCount / voteLimit}\n              color=\"linear-gradient(270deg, #DE7756 -30.07%, #FF672F 100%)\"\n              bgColor={colors.lightGreyishBlue}\n              bgShaded={false}\n            />\n            <ScreenReaderOnly>\n              <FormattedMessage\n                {...messages.xVotesOfY}\n                values={{ xVotes: voteCount, votingThreshold: voteLimit }}\n              />\n            </ScreenReaderOnly>\n          </div>\n        )}\n\n        {statusCode === 'expired' && (\n          <div>\n            <ExpiredText>\n              <ExpiredIcon name=\"clock\" ariaHidden />\n              <T value={initiativeStatus.attributes.title_multiloc} />\n            </ExpiredText>\n            <StyledProgressBar\n              progress={voteCount / voteLimit}\n              color={colors.label}\n              bgColor={colors.lightGreyishBlue}\n              bgShaded={true}\n            />\n          </div>\n        )}\n\n        {statusCode === 'threshold_reached' && (\n          <div>\n            <VoteCounter>\n              <VoteIcon name=\"upvote\" ariaHidden />\n              <VoteText aria-hidden>\n                <b>{voteCount}</b>\n                <span className=\"division-bar\">/</span>\n                {voteLimit}\n              </VoteText>\n              <ScreenReaderOnly>\n                <FormattedMessage\n                  {...messages.xVotesOfY}\n                  values={{ xVotes: voteCount, votingThreshold: voteLimit }}\n                />\n              </ScreenReaderOnly>\n            </VoteCounter>\n            <StyledProgressBar\n              progress={voteCount / voteLimit}\n              color={theme.colorMain}\n              bgColor={colors.lightGreyishBlue}\n              bgShaded={false}\n            />\n          </div>\n        )}\n\n        {statusCode === 'answered' && (\n          <AnsweredStatusBadge color={initiativeStatus.attributes.color}>\n            <AnsweredBadgeIcon name=\"round-checkmark\" ariaHidden />\n            <BadgeLabel>\n              <T value={initiativeStatus.attributes.title_multiloc} />\n            </BadgeLabel>\n          </AnsweredStatusBadge>\n        )}\n\n        {statusCode === 'ineligible' && (\n          <IneligibleStatusBadge color={initiativeStatus.attributes.color}>\n            <IneligibleBadgeIcon name=\"halt\" ariaHidden />\n            <BadgeLabel>\n              <T value={initiativeStatus.attributes.title_multiloc} />\n            </BadgeLabel>\n          </IneligibleStatusBadge>\n        )}\n\n        {statusCode === 'custom' && (\n          <CustomStatusBadge color={initiativeStatus.attributes.color}>\n            <BadgeLabel>\n              <T value={initiativeStatus.attributes.title_multiloc} />\n            </BadgeLabel>\n          </CustomStatusBadge>\n        )}\n      </Container>\n    );\n  }\n}\n\nconst Data = adopt<DataProps, InputProps>({\n  tenant: <GetAppConfiguration />,\n  initiative: ({ initiativeId, render }) => (\n    <GetInitiative id={initiativeId}>{render}</GetInitiative>\n  ),\n  initiativeStatus: ({ initiative, render }) => (\n    <GetInitiativeStatus\n      id={get(initiative, 'relationships.initiative_status.data.id')}\n    >\n      {render}\n    </GetInitiativeStatus>\n  ),\n});\n\nconst VoteIndicatorWithHOCs = withTheme(VoteIndicator);\n\nexport default (inputProps: InputProps) => (\n  <Data {...inputProps}>\n    {(dataProps) => <VoteIndicatorWithHOCs {...inputProps} {...dataProps} />}\n  </Data>\n);\n"],"sourceRoot":""}
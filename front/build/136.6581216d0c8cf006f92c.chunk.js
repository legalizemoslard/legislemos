(window.webpackJsonp=window.webpackJsonp||[]).push([[136],{"13cB":function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=(0,r("JRPe").defineMessages)({edit:{id:"app.components.admin.PostManager.PostPreview.edit",defaultMessage:"Edit"},delete:{id:"app.components.admin.PostManager.PostPreview.delete",defaultMessage:"Delete"},deleteInputConfirmation:{id:"app.components.admin.PostManager.PostPreview.deleteInputConfirmation",defaultMessage:"Are you sure you want to delete this input? This action cannot be undone."},deleteInputInTimelineConfirmation:{id:"app.components.admin.PostManager.PostPreview.deleteInputInTimelineConfirmation",defaultMessage:"Are you sure you want to delete this input? The input will be deleted from all project phases and cannot be recovered."},deleteInitiativeConfirmation:{id:"app.components.admin.PostManager.PostPreview.deleteInitiativeConfirmation",defaultMessage:"Are you sure you want to delete this initiative?"},voteCounts:{id:"app.components.admin.PostManager.PostPreview.voteCounts",defaultMessage:"Vote counts:"},currentStatus:{id:"app.components.admin.PostManager.PostPreview.currentStatus",defaultMessage:"Current status"},assignee:{id:"app.components.admin.PostManager.PostPreview.assignee",defaultMessage:"Assignee"},picks:{id:"app.components.admin.PostManager.PostPreview.picks",defaultMessage:"Picks: {picksNumber}"},pbItemCountTooltip:{id:"app.components.admin.PostManager.PostPreview.pbItemCountTooltip",defaultMessage:"The number of times this has been included in other participants' participatory budgets"},cancelEdit:{id:"app.components.admin.PostManager.PostPreview.cancelEdit",defaultMessage:"Cancel edit"},noOne:{id:"app.components.admin.PostManager.PostPreview.noOne",defaultMessage:"Unassigned"},save:{id:"app.components.admin.PostManager.PostPreview.save",defaultMessage:"Save"},submitError:{id:"app.components.admin.PostManager.PostPreview.submitError",defaultMessage:"Error"},postedIn:{id:"app.containers.IdeasShow.postedIn",defaultMessage:"Posted in {projectLink}"},xDaysLeft:{id:"app.containers.IdeasShow.xDaysLeft",defaultMessage:"{x, plural, =0 {Less than a day} one {One day} other {# days}} left"},proposedBudgetTitle:{id:"app.containers.IdeasShow.proposedBudgetTitle",defaultMessage:"Proposed budget"},bodyTitle:{id:"app.containers.IdeasShow.bodyTitle",defaultMessage:"Description"}});t.default=a},R4Xf:function(e,t,r){"use strict";r("SuFq"),r("tkto"),r("5DmW"),r("27RR"),r("ENF9");var a=r("TqRt"),n=r("cDf5");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=a(r("o0o1"));r("pNMO"),r("4Brf"),r("07d7"),r("5s+n"),r("2B1R"),r("TeQF"),r("sMBO"),r("4mDm"),r("PKPk"),r("3bBZ"),r("ma9I"),r("fbCW"),r("FZtP");var o=a(r("pVnL")),s=a(r("J4zp")),l=a(r("RIqP")),u=a(r("yXPU")),d=a(r("lwsE")),c=a(r("W8MJ")),p=a(r("PJYZ")),f=a(r("7W2i")),m=a(r("a1gu")),g=a(r("Nsbk")),b=a(r("lSNA")),v=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!==n(e)&&"function"!=typeof e)return{default:e};var r=Z(t);if(r&&r.has(e))return r.get(e);var a={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if("default"!==o&&Object.prototype.hasOwnProperty.call(e,o)){var s=i?Object.getOwnPropertyDescriptor(e,o):null;s&&(s.get||s.set)?Object.defineProperty(a,o,s):a[o]=e[o]}a.default=e,r&&r.set(e,a);return a}(r("q1tI")),h=r("ifvJ"),P=r("DtyJ"),y=r("ahDk"),I=r("KLnl"),M=a(r("JUYq")),E=a(r("2fl8")),O=a(r("Zc1O")),w=a(r("i59K")),j=r("b0Ul"),k=r("Tq1+"),T=r("H9u3"),C=r("ngE2"),S=r("EP0W"),F=r("iamO"),_=r("c95D"),B=r("Rw3A"),D=a(r("13cB")),x=a(r("IAnr")),R=r("1YJs"),N=r("mGTj"),J=r("96Cm"),U=a(r("vOnD")),W=a(r("Y9MJ")),L=a(r("yiTP")),q=a(r("YLV/")),A=a(r("yYlr")),Y=a(r("bHid")),K=r("KuRP");function Z(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(Z=function(e){return e?r:t})(e)}function $(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,a)}return r}function H(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?$(Object(r),!0).forEach((function(t){(0,b.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):$(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function Q(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,a=(0,g.default)(e);if(t){var n=(0,g.default)(this).constructor;r=Reflect.construct(a,arguments,n)}else r=a.apply(this,arguments);return(0,m.default)(this,r)}}var V=U.default.div.withConfig({displayName:"IdeaEdit__ButtonWrapper",componentId:"xw4g0j-0"})(["display:flex;justify-content:flex-start;"]),X=(0,U.default)(E.default).withConfig({displayName:"IdeaEdit__SaveButton",componentId:"xw4g0j-1"})(["margin-right:10px;"]),z=function(e){(0,f.default)(r,e);var t=Q(r);function r(e){var a;return(0,d.default)(this,r),a=t.call(this,e),(0,b.default)((0,p.default)(a),"subscriptions",void 0),(0,b.default)((0,p.default)(a),"handleOnSaveButtonClick",(function(){x.default.emit("IdeaFormSubmitEvent")})),(0,b.default)((0,p.default)(a),"handleIdeaFormOutput",function(){var e=(0,u.default)(i.default.mark((function e(t){var r,n,o,s,u,d,c,p,f,m,g,v,h,P,y,M,E,O,w,j,k,T,F,B,D,x,R,J,U,W,L,q,A,Z,$,Q,V,X,z;return i.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=a.props,n=r.ideaId,o=r.goBack,s=r.authUser,u=r.appConfiguration,d=a.state,c=d.locale,p=d.titleMultiloc,f=d.descriptionMultiloc,m=d.imageId,g=d.imageFile,v=d.authorId,h=d.address,P=d.projectId,y=t.title,M=t.description,E=t.selectedTopics,O=t.address,w=t.budget,j=t.proposedBudget,k=t.ideaFiles,T=t.ideaFilesToRemove,F=t.authorId,B=m,D=g&&g.length>0?g[0]:null,x=D?D.base64:null,R=t.imageFile&&t.imageFile.length>0?t.imageFile[0]:null,J=R?R.base64:null,U=J&&x!==J?(0,S.addIdeaImage)(n,J,0):Promise.resolve(null),W=k.filter((function(e){return!e.remote})).map((function(e){return(0,_.addIdeaFile)(n,e.base64,e.name)})),L=T.filter((function(e){return!(!e.remote||!e.id)})).map((function(e){return(0,_.deleteIdeaFile)(n,e.id)})),q=F||v,A={},O===h){e.next=19;break}return e.next=16,(0,N.geocode)(O);case 16:Z=e.sent,A.location_description=O,Z&&(A.location_point_geojson=Z);case 19:if($=(0,C.updateIdea)(n,H({budget:w,proposed_budget:j,title_multiloc:H(H({},p),{},(0,b.default)({},c,y)),body_multiloc:H(H({},f),{},(0,b.default)({},c,M)),topic_ids:E,author_id:q},A)),a.setState({processing:!0,submitError:!1}),e.prev=21,!B||x===J){e.next=25;break}return e.next=25,(0,S.deleteIdeaImage)(n,B);case 25:return e.next=27,Promise.all([$,U].concat((0,l.default)(W),(0,l.default)(L)));case 27:o(),e.next=37;break;case 30:e.prev=30,e.t0=e.catch(21),Q=e.t0.json.errors,(V=Q.base.find((function(e){return"includes_banned_words"===e.error})))&&(X=V.blocked_words.some((function(e){return"title_multiloc"===e.attribute})),z=V.blocked_words.some((function(e){return"body_multiloc"===e.attribute})),X&&((0,K.trackEventByName)(Y.default.titleProfanityError.name,{ideaId:n,projectId:P,locale:c,profaneMessage:y,location:"IdeaEdit (Input manager in admin)",userId:(0,I.isNilOrError)(s)?null:s.id,host:(0,I.isNilOrError)(u)?null:u.attributes.host}),a.setState({titleProfanityError:X})),z&&((0,K.trackEventByName)(Y.default.descriptionProfanityError.name,{ideaId:n,projectId:P,locale:c,profaneMessage:M,location:"IdeaEdit (Input manager in admin)",userId:(0,I.isNilOrError)(s)?null:s.id,host:(0,I.isNilOrError)(u)?null:u.attributes.host}),a.setState({descriptionProfanityError:z}))),a.setState({processing:!1,submitError:!0});case 37:case"end":return e.stop()}}),e,null,[[21,30]])})));return function(t){return e.apply(this,arguments)}}()),(0,b.default)((0,p.default)(a),"onTitleChange",(function(e){var t=a.props.locale;if(!(0,I.isNilOrError)(t)){var r=(0,b.default)({},t,e);a.setState({titleMultiloc:r,titleProfanityError:!1})}})),(0,b.default)((0,p.default)(a),"onDescriptionChange",(function(e){var t=a.props.locale;if(!(0,I.isNilOrError)(t)){var r=(0,b.default)({},t,e);a.setState({descriptionMultiloc:r,descriptionProfanityError:!1})}})),a.state={projectId:null,authorId:null,locale:"en",titleMultiloc:null,descriptionMultiloc:null,selectedTopics:[],budget:null,proposedBudget:null,address:null,imageFile:[],imageId:null,submitError:!1,titleProfanityError:!1,descriptionProfanityError:!1,loaded:!1,processing:!1},a.subscriptions=[],a}return(0,c.default)(r,[{key:"componentDidMount",value:function(){var e=this,t=this.props.ideaId,r=(0,k.localeStream)().observable,a=(0,T.currentAppConfigurationStream)().observable.pipe((0,y.map)((function(e){return e.data.attributes.settings.core.locales}))),n=(0,C.ideaByIdStream)(t).observable,i=(0,P.combineLatest)(r,a,n).pipe((0,y.switchMap)((function(e){var t=(0,s.default)(e,3),a=(t[0],t[1],t[2]),i=a.data.id,o=a.data.relationships.idea_images.data,l=o&&o.length>0?o[0].id:null,u=l?(0,S.ideaImageStream)(i,l).observable.pipe((0,y.first)(),(0,y.switchMap)((function(e){if(e&&e.data&&e.data.attributes.versions.large){var t=e.data.attributes.versions.large,r=e.data.id;return(0,R.convertUrlToUploadFileObservable)(t,r,null)}return(0,P.of)(null)}))):(0,P.of)(null),d=(0,F.hasPermission)({item:a.data,action:"edit",context:a.data});return(0,P.combineLatest)(r,n,u,d)})));this.subscriptions=[i.subscribe((function(t){var r,a,n=(0,s.default)(t,4),i=n[0],o=n[1],l=n[2];n[3]?e.setState({locale:i,selectedTopics:(null===(r=o.data.relationships.topics)||void 0===r?void 0:r.data.map((function(e){return e.id})))||[],projectId:o.data.relationships.project.data.id,loaded:!0,titleMultiloc:o.data.attributes.title_multiloc,descriptionMultiloc:o.data.attributes.body_multiloc,address:o.data.attributes.location_description,budget:o.data.attributes.budget,authorId:(null===(a=o.data.relationships.author.data)||void 0===a?void 0:a.id)||null,proposedBudget:o.data.attributes.proposed_budget,imageFile:l?[l]:[],imageId:l&&l.id?l.id:null}):M.default.push("/")}))]}},{key:"componentWillUnmount",value:function(){this.subscriptions.forEach((function(e){return e.unsubscribe()}))}},{key:"render",value:function(){if(this.state&&this.state.loaded){var e=this.props,t=e.remoteIdeaFiles,r=e.goBack,a=this.state,n=a.locale,i=a.projectId,o=a.titleMultiloc,s=a.descriptionMultiloc,l=a.selectedTopics,u=a.address,d=a.imageFile,c=a.submitError,p=a.processing,f=a.budget,m=a.proposedBudget,g=a.titleProfanityError,b=a.descriptionProfanityError,h=a.authorId,P=n&&o&&o[n]||"",y=n&&s?s[n]||"":null,M=c?v.default.createElement(B.FormattedMessage,D.default.submitError):null;return i?v.default.createElement(j.Container,null,v.default.createElement(j.Top,null,v.default.createElement(E.default,{icon:"arrow-back",buttonStyle:"text",textColor:J.colors.adminTextColor,onClick:r},v.default.createElement(B.FormattedMessage,D.default.cancelEdit))),v.default.createElement(j.Content,{className:"idea-form"},v.default.createElement(w.default,{authorId:h,projectId:i,title:P,description:y,selectedTopics:l,budget:f,proposedBudget:m,address:u||"",imageFile:d,onSubmit:this.handleIdeaFormOutput,remoteIdeaFiles:(0,I.isNilOrError)(t)?null:t,hasTitleProfanityError:g,hasDescriptionProfanityError:b,onTitleChange:this.onTitleChange,onDescriptionChange:this.onDescriptionChange}),v.default.createElement(V,null,v.default.createElement(X,{processing:p,text:v.default.createElement(B.FormattedMessage,D.default.save),onClick:this.handleOnSaveButtonClick}),v.default.createElement(O.default,{text:M,marginTop:"0px"})))):null}return null}}]),r}(v.PureComponent),G=(0,h.adopt)({authUser:v.default.createElement(q.default,null),appConfiguration:v.default.createElement(A.default,null),locale:v.default.createElement(L.default,null),remoteIdeaFiles:function(e){var t=e.ideaId,r=e.render;return v.default.createElement(W.default,{resourceId:t,resourceType:"idea"},r)}});t.default=function(e){return v.default.createElement(G,e,(function(t){return v.default.createElement(z,(0,o.default)({},t,e))}))}},Y9MJ:function(e,t,r){"use strict";r("SuFq");var a=r("TqRt");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,r("2B1R"),r("sMBO"),r("TeQF"),r("FZtP");var n=a(r("lwsE")),i=a(r("W8MJ")),o=a(r("PJYZ")),s=a(r("7W2i")),l=a(r("a1gu")),u=a(r("Nsbk")),d=a(r("lSNA")),c=a(r("q1tI")),p=r("T89o"),f=r("KLnl"),m=r("DtyJ"),g=r("ahDk"),b=a(r("aTp4")),v=r("Nv6i"),h=r("jtPO"),P=r("vDWu"),y=r("pQfs"),I=r("c95D"),M=r("OKda"),E=r("1YJs");function O(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,a=(0,u.default)(e);if(t){var n=(0,u.default)(this).constructor;r=Reflect.construct(a,arguments,n)}else r=a.apply(this,arguments);return(0,l.default)(this,r)}}var w=function(e){(0,s.default)(r,e);var t=O(r);function r(e){var a;return(0,n.default)(this,r),a=t.call(this,e),(0,d.default)((0,o.default)(a),"inputProps$",void 0),(0,d.default)((0,o.default)(a),"subscriptions",void 0),a.state={files:void 0},a}return(0,i.default)(r,[{key:"componentDidMount",value:function(){var e=this,t=this.props,r=t.resourceId,a=t.resourceType,n=t.resetOnChange;this.inputProps$=new m.BehaviorSubject({resourceId:r,resourceType:a}),this.subscriptions=[this.inputProps$.pipe((0,g.distinctUntilChanged)((function(e,t){return(0,b.default)(e,t)})),(0,g.tap)((function(){return n&&e.setState({files:void 0})})),(0,g.filter)((function(e){var t=e.resourceId;return(0,p.isString)(t)})),(0,g.switchMap)((function(e){var t,r=e.resourceId,a=e.resourceType;return"project"===a&&(t=v.projectFilesStream),"phase"===a&&(t=h.phaseFilesStream),"event"===a&&(t=y.eventFilesStream),"page"===a&&(t=P.pageFilesStream),"idea"===a&&(t=I.ideaFilesStream),"initiative"===a&&(t=M.initiativeFilesStream),t(r).observable})),(0,g.switchMap)((function(e){return e&&e.data&&e.data.length>0?(0,m.combineLatest)(e.data.map((function(e){return(0,E.convertUrlToUploadFileObservable)(e.attributes.file.url,e.id,e.attributes.name)}))):(0,m.of)(null)}))).subscribe((function(t){e.setState({files:t?t.filter((function(e){return!(0,f.isNilOrError)(e)})):null})}))]}},{key:"componentDidUpdate",value:function(){var e=this.props,t=e.resourceId,r=e.resourceType,a=e.resetOnChange;this.inputProps$.next({resourceId:t,resourceType:r,resetOnChange:a})}},{key:"componentWillUnmount",value:function(){this.subscriptions.forEach((function(e){return e.unsubscribe()}))}},{key:"render",value:function(){return(0,this.props.children)(this.state.files)}}]),r}(c.default.Component);t.default=w,(0,d.default)(w,"defaultProps",{resetOnChange:!0})},bHid:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;t.default={titleProfanityError:{name:"Profane idea title blocked"},descriptionProfanityError:{name:"Profane idea description blocked"}}}}]);
//# sourceMappingURL=136.6581216d0c8cf006f92c.chunk.js.map
(window.webpackJsonp=window.webpackJsonp||[]).push([[49],{"1c8T":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=(0,n("JRPe").defineMessages)({buttonSuccessLabel:{id:"app.containers.CampaignsConsentForm.buttonSuccessLabel",defaultMessage:"Success"},messageError:{id:"app.containers.CampaignsConsentForm.messageError",defaultMessage:"There was an error saving your email preferences."},messageSuccess:{id:"app.containers.CampaignsConsentForm.messageSuccess",defaultMessage:"Your email preferences have been saved."},submit:{id:"app.containers.CampaignsConsentForm.submit",defaultMessage:"Save"},notificationsTitle:{id:"app.containers.CampaignsConsentForm.notificationsTitle",defaultMessage:"Notifications"},notificationsSubTitle:{id:"app.containers.CampaignsConsentForm.notificationsSubTitle",defaultMessage:"When do you want us to send you an email to notify you?"},ownCategory:{id:"app.containers.CampaignsConsentForm.ownCategory",defaultMessage:"Linked to your own input"},officialCategory:{id:"app.containers.CampaignsConsentForm.officialCategory",defaultMessage:"Official Messages"},weeklyCategory:{id:"app.containers.CampaignsConsentForm.weeklyCategory",defaultMessage:"Weekly Overviews"},votedCategory:{id:"app.containers.CampaignsConsentForm.votedCategory",defaultMessage:"Linked to input you voted for"},commentedCategory:{id:"app.containers.CampaignsConsentForm.commentedCategory",defaultMessage:"Linked to input you commented on"},mentionCategory:{id:"app.containers.CampaignsConsentForm.mentionCategory",defaultMessage:"Mentions"},adminCategory:{id:"app.containers.CampaignsConsentForm.adminCategory",defaultMessage:"Admin"},collapse:{id:"app.containers.CampaignsConsentForm.collapse",defaultMessage:"Collapse"},expand:{id:"app.containers.CampaignsConsentForm.expand",defaultMessage:"Expand"},ally_categoryLabel:{id:"app.containers.CampaignsConsentForm.ally_categoryLabel",defaultMessage:"Emails in this category"}});t.default=a},"729O":function(e,t,n){"use strict";n("SuFq"),n("pNMO"),n("TeQF"),n("5DmW"),n("27RR"),n("ENF9");var a=n("TqRt"),o=n("cDf5");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,n("FZtP"),n("fbCW"),n("2B1R"),n("tkto"),n("4mDm"),n("07d7"),n("5s+n"),n("PKPk"),n("3bBZ"),n("T63A"),n("ma9I");var r=a(n("J4zp")),i=a(n("lwsE")),s=a(n("W8MJ")),c=a(n("PJYZ")),u=a(n("7W2i")),l=a(n("a1gu")),d=a(n("Nsbk")),f=a(n("lSNA")),p=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!==o(e)&&"function"!=typeof e)return{default:e};var n=M(t);if(n&&n.has(e))return n.get(e);var a={},r=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var i in e)if("default"!==i&&Object.prototype.hasOwnProperty.call(e,i)){var s=r?Object.getOwnPropertyDescriptor(e,i):null;s&&(s.get||s.set)?Object.defineProperty(a,i,s):a[i]=e[i]}a.default=e,n&&n.set(e,a);return a}(n("q1tI")),m=n("M57m"),g=a(n("hLGy")),h=a(n("3A/8")),C=a(n("2fl8")),y=a(n("8jGB")),b=a(n("G62B")),v=n("+9pX"),k=n("KuRP"),x=n("OUuu"),O=a(n("1c8T")),w=n("Rw3A"),S=a(n("vOnD")),P=n("96Cm"),E=n("iP56"),_=n("iTG7");function M(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(M=function(e){return e?n:t})(e)}function F(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function j(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?F(Object(n),!0).forEach((function(t){(0,f.default)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):F(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function I(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,a=(0,d.default)(e);if(t){var o=(0,d.default)(this).constructor;n=Reflect.construct(a,arguments,o)}else n=a.apply(this,arguments);return(0,l.default)(this,n)}}var z=S.default.div.withConfig({displayName:"ConsentForm__CategoryCheckboxContainer",componentId:"zdx5kf-0"})(["display:flex;justify-content:space-between;"]),T=(0,S.default)(y.default).withConfig({displayName:"ConsentForm__StyledCheckboxWithPartialCheck",componentId:"zdx5kf-1"})([""]),N=(0,S.default)(E.Icon).withConfig({displayName:"ConsentForm__ArrowIcon",componentId:"zdx5kf-2"})(["flex:0 0 12px;width:12px;height:12px;transform:rotate(90deg);transition:all 0.2s linear;margin-left:5px;&.open{transform:rotate(0deg);}"]),A=S.default.fieldset.withConfig({displayName:"ConsentForm__AnimatedFieldset",componentId:"zdx5kf-3"})(["border:none;margin:0;padding:0;opacity:0;display:none;transition:all ","ms cubic-bezier(0.165,0.84,0.44,1);will-change:opacity,height;&.collapse-enter{opacity:0;max-height:0px;overflow:hidden;display:block;&.collapse-enter-active{opacity:1;max-height:350px;overflow:hidden;display:block;}}&.collapse-enter-done{opacity:1;overflow:visible;display:block;}&.collapse-exit{opacity:1;max-height:350px;overflow:hidden;display:block;&.collapse-exit-active{opacity:0;max-height:0px;overflow:hidden;display:block;}}&.collapse-exit-done{display:none;}"],400),D=S.default.div.withConfig({displayName:"ConsentForm__CheckboxContainer",componentId:"zdx5kf-4"})(["margin-bottom:12px;margin-left:34px;&.first{margin-top:15px;}"]),W=S.default.div.withConfig({displayName:"ConsentForm__ConsentList",componentId:"zdx5kf-5"})(["padding-top:14px;padding-bottom:14px;border-bottom:1px solid ",";&.first{border-top:1px solid ",";}&.last{margin-bottom:20px;}"],P.colors.separation,P.colors.separation),R=(0,S.default)(g.default).withConfig({displayName:"ConsentForm__StyledSubmitWrapper",componentId:"zdx5kf-6"})([""]),B=function(e){(0,u.default)(n,e);var t=I(n);function n(e){var a;return(0,i.default)(this,n),a=t.call(this,e),(0,f.default)((0,c.default)(a),"handleOnChange",(function(e){return function(){var t=a.isConsented(e.id);a.setState((function(n){return{consentChanges:j(j({},n.consentChanges),{},(0,f.default)({},e.id,!t)),saveButtonStatus:"enabled"}}))}})),(0,f.default)((0,c.default)(a),"consent",(function(e){a.setState((function(t){return{consentChanges:j(j({},t.consentChanges),{},(0,f.default)({},e.id,!0)),saveButtonStatus:"enabled"}}))})),(0,f.default)((0,c.default)(a),"unconsent",(function(e){a.setState((function(t){return{consentChanges:j(j({},t.consentChanges),{},(0,f.default)({},e.id,!1)),saveButtonStatus:"enabled"}}))})),(0,f.default)((0,c.default)(a),"handleOnChangeCategory",(function(e){return function(){var t=a.state.categorizedConsents;t[e].every((function(e){return a.isConsented(e.id)}))?t[e].forEach((function(e){return a.unconsent(e)})):(t[e].forEach((function(e){return a.consent(e)})),a.setState((function(t){return{isCategoryOpen:j(j({},t.isCategoryOpen),{},(0,f.default)({},e,!1))}})))}})),(0,f.default)((0,c.default)(a),"handleToggleOpenCategory",(function(e){return function(t){t.stopPropagation(),a.setState((function(t){var n=t.isCategoryOpen;return{isCategoryOpen:j(j({},n),{},(0,f.default)({},e,!n[e]))}}))}})),(0,f.default)((0,c.default)(a),"isConsented",(function(e){var t=a.props.consents.find((function(t){return t.id===e}));return void 0===a.state.consentChanges[e]?t&&t.attributes.consented:a.state.consentChanges[e]})),(0,f.default)((0,c.default)(a),"isConsentedCategory",(function(e){var t=a.state.categorizedConsents;return!!t[e].find((function(e){return a.isConsented(e.id)}))&&(t[e].every((function(e){return a.isConsented(e.id)}))||"mixed")})),(0,f.default)((0,c.default)(a),"handleOnSubmit",(function(){var e=a.props,t=e.trackEventName,n=e.token,o=e.runOnSave,r=a.state.consentChanges,i=[];(0,k.trackEventByName)(t,{extra:{consentChanges:r}}),a.setState({isSaving:!0,saveButtonStatus:"disabled"}),r&&(i=Object.keys(r).map((function(e){return n?(0,m.updateConsentWithToken)(e,a.isConsented(e),n):(0,m.updateConsent)(e,a.isConsented(e))}))),Promise.all(i).then((function(){a.setState({consentChanges:{},isSaving:!1,saveButtonStatus:"success"}),o&&o()})).catch((function(){a.setState({saveButtonStatus:"error"})}))})),a.state={categorizedConsents:{},isCategoryOpen:{},consentChanges:{},isSaving:!1,saveButtonStatus:"disabled"},a}return(0,s.default)(n,[{key:"componentDidMount",value:function(){var e=(0,m.getCategorizedConsents)(this.props.consents),t={};Object.keys(e).forEach((function(n){return t[n]=!e[n].every((function(e){return e.attributes.consented}))&&!e[n].every((function(e){return!e.attributes.consented}))})),this.setState({categorizedConsents:e,isCategoryOpen:t})}},{key:"componentDidUpdate",value:function(e){var t=this.props.consents;e.consents!==t&&this.setState({categorizedConsents:(0,m.getCategorizedConsents)(t)})}},{key:"render",value:function(){var e=this,t=this.state,n=t.isSaving,a=t.saveButtonStatus,o=t.categorizedConsents,i=t.isCategoryOpen;return p.default.createElement(x.FormSection,{id:"e2e-consent-form"},p.default.createElement("form",{action:""},p.default.createElement(x.FormSectionTitle,{message:O.default.notificationsTitle,subtitleMessage:O.default.notificationsSubTitle}),Object.entries(o).map((function(t,n){var a=(0,r.default)(t,2),s=a[0],c=a[1];return p.default.createElement(W,{key:s,className:"".concat(0===n?"first":""," ").concat(n===Object.entries(o).length-1?"last":"")},p.default.createElement(z,null,p.default.createElement(T,{id:s,checked:e.isConsentedCategory(s),onChange:e.handleOnChangeCategory(s),label:p.default.createElement(w.FormattedMessage,O.default["".concat(s,"Category")])}),c.length>1&&p.default.createElement(C.default,{onClick:e.handleToggleOpenCategory(s),buttonStyle:"text",type:"button",ariaExpanded:i[s],padding:"0px"},i[s]?p.default.createElement(w.FormattedMessage,O.default.collapse):p.default.createElement(w.FormattedMessage,O.default.expand),p.default.createElement(N,{name:"dropdown",className:i[s]?"open":"",ariaHidden:!0}))),p.default.createElement(_.CSSTransition,{classNames:"collapse",in:i[s],appear:i[s],timeout:400,mounOnEnter:!1,unmountOnExit:!1,enter:!0,exit:!0},p.default.createElement(A,null,p.default.createElement(v.ScreenReaderOnly,null,p.default.createElement("legend",null,p.default.createElement(w.FormattedMessage,O.default.ally_categoryLabel))),c.length>1&&c.map((function(t,n){return p.default.createElement(D,{key:t.id,className:"".concat(0===n?"first":""," ").concat(n===c.length-1?"last":"")},p.default.createElement(b.default,{size:"20px",checked:e.isConsented(t.id),onChange:e.handleOnChange(t),label:p.default.createElement(h.default,{value:t.attributes.campaign_type_description_multiloc})}))})))))})),p.default.createElement(R,{status:a,buttonStyle:"primary",loading:n,onClick:this.handleOnSubmit,messages:{buttonSave:O.default.submit,buttonSuccess:O.default.buttonSuccessLabel,messageSuccess:O.default.messageSuccess,messageError:O.default.messageError}})))}}]),n}(p.PureComponent);t.default=B},"8jGB":function(e,t,n){"use strict";n("SuFq"),n("4mDm"),n("07d7"),n("PKPk"),n("ENF9"),n("3bBZ"),n("5DmW");var a=n("TqRt"),o=n("cDf5");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,n("ma9I");var r,i,s=a(n("lwsE")),c=a(n("W8MJ")),u=a(n("PJYZ")),l=a(n("7W2i")),d=a(n("a1gu")),f=a(n("Nsbk")),p=a(n("lSNA")),m=a(n("VkAN")),g=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!==o(e)&&"function"!=typeof e)return{default:e};var n=v(t);if(n&&n.has(e))return n.get(e);var a={},r=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var i in e)if("default"!==i&&Object.prototype.hasOwnProperty.call(e,i)){var s=r?Object.getOwnPropertyDescriptor(e,i):null;s&&(s.get||s.set)?Object.defineProperty(a,i,s):a[i]=e[i]}a.default=e,n&&n.set(e,a);return a}(n("q1tI")),h=a(n("vOnD")),C=n("96Cm"),y=n("iP56"),b=n("T89o");function v(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(v=function(e){return e?n:t})(e)}function k(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,a=(0,f.default)(e);if(t){var o=(0,f.default)(this).constructor;n=Reflect.construct(a,arguments,o)}else n=a.apply(this,arguments);return(0,d.default)(this,n)}}var x=h.default.div.withConfig({displayName:"CheckboxWithPartialCheck__Container",componentId:"o0o47n-0"})(["display:flex;align-items:center;cursor:pointer;"," &.hasNoLabel{flex:0 0 ","px;width:","px;height:","px;}label{cursor:pointer;}&.disabled{cursor:not-allowed;label{cursor:not-allowed;}}"],(0,C.isRtl)(r||(r=(0,m.default)(["\n    flex-direction: row-reverse;\n  "]))),(function(e){var t=e.size;return parseInt(t,10)+2}),(function(e){var t=e.size;return parseInt(t,10)+2}),(function(e){var t=e.size;return parseInt(t,10)+2})),O=h.default.div.withConfig({displayName:"CheckboxWithPartialCheck__CustomInputWrapper",componentId:"o0o47n-1"})(["position:relative;flex:0 0 ","px;width:","px;height:","px;color:#fff;text-align:center;display:flex;align-items:center;justify-content:center;border:solid 1px ",";border-radius:",";background:",";border-color:",";box-shadow:inset 0px 1px 1px rgba(0,0,0,0.15);&:hover{border-color:",";}"],(function(e){var t=e.size;return parseInt(t,10)}),(function(e){var t=e.size;return parseInt(t,10)}),(function(e){var t=e.size;return parseInt(t,10)}),C.colors.separationDark,(function(e){return e.theme.borderRadius}),(function(e){return e.checked?C.colors.clGreen:"#fff"}),(function(e){return e.checked?C.colors.clGreen:"#aaa"}),(function(e){return"mixed"===e.checked?C.colors.clBlueLightest:e.checked?C.colors.clGreen:"#333"})),w=(0,h.default)(y.Icon).withConfig({displayName:"CheckboxWithPartialCheck__CheckmarkIcon",componentId:"o0o47n-2"})(["fill:#fff;width:15px;"]),S=h.default.label.withConfig({displayName:"CheckboxWithPartialCheck__Label",componentId:"o0o47n-3"})(["color:",";font-size:","px;line-height:normal;margin-left:10px;",""],C.colors.label,C.fontSizes.base,(0,C.isRtl)(i||(i=(0,m.default)(["\n    margin-left: 0;\n    margin-right: 10px;\n  "])))),P=function(e){(0,l.default)(n,e);var t=k(n);function n(){var e;(0,s.default)(this,n);for(var a=arguments.length,o=new Array(a),r=0;r<a;r++)o[r]=arguments[r];return e=t.call.apply(t,[this].concat(o)),(0,p.default)((0,u.default)(e),"handleOnClick",(function(t){if(!e.props.disabled){var n=(0,b.get)(t,"target"),a=(0,b.get)(t,"target.parentElement"),o=n&&n.hasAttribute&&n.hasAttribute("href"),r=a&&a.hasAttribute&&a.hasAttribute("href");o||r||(t&&t.preventDefault(),e.props.onChange(t))}})),(0,p.default)((0,u.default)(e),"handleOnKeyDown",(function(t){if(!e.props.disabled){var n=(0,b.get)(t,"target"),a=(0,b.get)(t,"target.parentElement"),o=n&&n.hasAttribute&&n.hasAttribute("href"),r=a&&a.hasAttribute&&a.hasAttribute("href");o||r||32!==t.keyCode||(t&&t.preventDefault(),e.props.onChange(t))}})),(0,p.default)((0,u.default)(e),"removeFocus",(function(e){e.preventDefault()})),e}return(0,c.default)(n,[{key:"render",value:function(){var e=this.props,t=e.label,n=e.size,a=e.checked,o=e.className,r=e.notFocusable,i=e["data-testid"];return g.default.createElement(x,{size:n,onMouseDown:this.removeFocus,onClick:this.handleOnClick,onKeyDown:this.handleOnKeyDown,className:"".concat(o||""," ").concat(t?"hasLabel":"hasNoLabel"),role:"checkbox","aria-checked":a,tabIndex:r?-1:0,"data-testid":i},g.default.createElement(O,{size:n,checked:a},"mixed"===a?g.default.createElement(w,{ariaHidden:!0,name:"more-options"}):a&&g.default.createElement(w,{ariaHidden:!0,name:"checkmark"})),g.default.createElement(S,null,t))}}]),n}(g.PureComponent);t.default=P,(0,p.default)(P,"defaultProps",{size:"22px"})},M57m:function(e,t,n){"use strict";var a=n("TqRt");Object.defineProperty(t,"__esModule",{value:!0}),t.getCategorizedConsents=function(e){var t={};return i.forEach((function(n){var a=e.filter((function(e){return e.attributes.category===n}));a.length>0&&(t[n]=a)})),t},t.consentsStream=function(){return r.default.get({apiEndpoint:"".concat(o.API_PATH,"/consents")})},t.updateConsent=function(e,t){return r.default.update("".concat(o.API_PATH,"/consents/").concat(e),e,{consent:{consented:t}})},t.updateConsentWithToken=function(e,t,n){return r.default.update("".concat(o.API_PATH,"/consents/").concat(e,"?unsubscription_token=").concat(n),e,{consent:{consented:t}})},t.updateConsentByCampaignIDWithToken=function(e,t,n){return r.default.update("".concat(o.API_PATH,"/consents/by_campaign_id/").concat(e),e,{consent:{consented:t},unsubscription_token:n})},t.consentsWithTokenStream=function(e){return r.default.get({apiEndpoint:"".concat(o.API_PATH,"/consents?unsubscription_token=").concat(e)})},n("TeQF"),n("ma9I");var o=n("p0gT"),r=a(n("1Kqg")),i=["own","official","weekly","mention","commented","voted","admin"]}}]);
//# sourceMappingURL=49.099a2ac18a14b5b1a6f2.chunk.js.map
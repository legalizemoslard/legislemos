(window.webpackJsonp=window.webpackJsonp||[]).push([[51],{"451q":function(e,t,a){"use strict";a("SuFq"),a("4mDm"),a("07d7"),a("PKPk"),a("ENF9"),a("3bBZ"),a("5DmW");var n=a("TqRt"),r=a("cDf5");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(a("pVnL")),l=n(a("lwsE")),s=n(a("W8MJ")),u=n(a("PJYZ")),o=n(a("7W2i")),d=n(a("a1gu")),c=n(a("Nsbk")),f=n(a("lSNA")),p=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!==r(e)&&"function"!=typeof e)return{default:e};var a=D(t);if(a&&a.has(e))return a.get(e);var n={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var l in e)if("default"!==l&&Object.prototype.hasOwnProperty.call(e,l)){var s=i?Object.getOwnPropertyDescriptor(e,l):null;s&&(s.get||s.set)?Object.defineProperty(n,l,s):n[l]=e[l]}n.default=e,a&&a.set(e,n);return n}(a("q1tI"));a("GG7f"),a("P+y9");var m=a("qNGI"),h=n(a("vOnD")),b=a("96Cm"),g=n(a("QAS3")),P=a("Rw3A"),v=a("T89o");function D(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,a=new WeakMap;return(D=function(e){return e?a:t})(e)}function y(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var a,n=(0,c.default)(e);if(t){var r=(0,c.default)(this).constructor;a=Reflect.construct(n,arguments,r)}else a=n.apply(this,arguments);return(0,d.default)(this,a)}}var M=h.default.div.withConfig({displayName:"DateRangePicker__StylingWrapper",componentId:"medgjs-0"})([".DateRangePickerInput{border-radius:",";border:solid 1px ",";&:hover{border-color:",";}.DateInput,.DateInput_input{color:",";font-size:","px;line-height:normal;font-weight:400;background:transparent;}}"],(function(e){return e.theme.borderRadius}),b.colors.border,b.colors.hoveredBorder,b.colors.text,b.fontSizes.base),S=function(e){(0,o.default)(a,e);var t=y(a);function a(e){var n;return(0,l.default)(this,a),n=t.call(this,e),(0,f.default)((0,u.default)(n),"handleFocusChange",(function(e){n.setState({focusedInput:e})})),(0,f.default)((0,u.default)(n),"handleIsOutsideRange",(function(){return!1})),n.state={focusedInput:null},n}return(0,s.default)(a,[{key:"render",value:function(){return p.default.createElement(M,{className:this.props.className},p.default.createElement(m.DateRangePicker,(0,i.default)({},(0,v.omit)(this.props,"intl"),{startDateId:"startAt",endDateId:"endAt",focusedInput:this.state.focusedInput,onFocusChange:this.handleFocusChange,startDatePlaceholderText:this.props.intl.formatMessage(g.default.startDatePlaceholder),endDatePlaceholderText:this.props.intl.formatMessage(g.default.endDatePlaceholder),isOutsideRange:this.handleIsOutsideRange})))}}]),a}(p.PureComponent),j=(0,P.injectIntl)(S);t.default=j},"9hsD":function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=(0,a("JRPe").defineMessages)({editPhaseTitle:{id:"app.containers.AdminPage.ProjectTimeline.editPhaseTitle",defaultMessage:"Edit Phase"},newPhaseTitle:{id:"app.containers.AdminPage.ProjectTimeline.newPhaseTitle",defaultMessage:"New Phase"},titleLabel:{id:"app.containers.AdminPage.ProjectTimeline.titleLabel",defaultMessage:"Title"},descriptionLabel:{id:"app.containers.AdminPage.ProjectTimeline.descriptionLabel",defaultMessage:"Description"},datesLabel:{id:"app.containers.AdminPage.ProjectTimeline.datesLabel",defaultMessage:"Dates"},saveLabel:{id:"app.containers.AdminPage.ProjectTimeline.saveLabel",defaultMessage:"Save"},saveSuccessLabel:{id:"app.containers.AdminPage.ProjectTimeline.saveSuccessLabel",defaultMessage:"Success"},saveErrorMessage:{id:"app.containers.AdminPage.ProjectTimeline.saveErrorMessage",defaultMessage:"There was an error submitting the form, please try again."},saveSuccessMessage:{id:"app.containers.AdminPage.ProjectTimeline.saveSuccessMessage",defaultMessage:"Your changes have been saved successfully."},orderColumnTitle:{id:"app.containers.AdminPage.ProjectTimeline.orderColumnTitle",defaultMessage:"Order"},nameColumnTitle:{id:"app.containers.AdminPage.ProjectTimeline.nameColumnTitle",defaultMessage:"Name & Dates"},addPhaseButton:{id:"app.containers.AdminPage.ProjectTimeline.addPhaseButton",defaultMessage:"Add a phase"},editPhaseButton:{id:"app.containers.AdminPage.ProjectTimeline.editPhaseButton",defaultMessage:"Edit"},deletePhaseButton:{id:"app.containers.AdminPage.ProjectTimeline.deletePhaseButton",defaultMessage:"Delete"},deletePhaseConfirmation:{id:"app.containers.AdminPage.ProjectTimeline.deletePhaseConfirmation",defaultMessage:"Are you sure you wannna delete this phase?"},startDatePlaceholder:{id:"app.containers.AdminPage.ProjectTimeline.startDatePlaceholder",defaultMessage:"Start Date"},endDatePlaceholder:{id:"app.containers.AdminPage.ProjectTimeline.endDatePlaceholder",defaultMessage:"End Date"},fileUploadLabel:{id:"app.containers.AdminPage.ProjectTimeline.fileUploadLabel",defaultMessage:"Attach files to this phase"},titleTimeline:{id:"app.containers.AdminPage.ProjectTimeline.titleTimeline",defaultMessage:"Manage timeline phases"},subtitleTimeline:{id:"app.containers.AdminPage.ProjectTimeline.subtitleTimeline",defaultMessage:"Define the different timeline phases for your project and describe what each phase is about. In every phase you can pick a different participation method: idea gathering, surveys, information, voting, commenting or participatory budgeting."}});t.default=n},EiUT:function(e,t,a){"use strict";a("SuFq"),a("tkto"),a("pNMO"),a("5DmW"),a("27RR"),a("ENF9");var n=a("TqRt"),r=a("cDf5");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(a("o0o1"));a("ma9I"),a("TeQF"),a("2B1R"),a("sMBO"),a("4mDm"),a("07d7"),a("5s+n"),a("PKPk"),a("3bBZ"),a("FZtP");var l=n(a("pVnL")),s=n(a("J4zp")),u=n(a("yXPU")),o=n(a("RIqP")),d=n(a("lwsE")),c=n(a("W8MJ")),f=n(a("PJYZ")),p=n(a("7W2i")),m=n(a("a1gu")),h=n(a("Nsbk")),b=n(a("lSNA")),g=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!==r(e)&&"function"!=typeof e)return{default:e};var a=Z(t);if(a&&a.has(e))return a.get(e);var n={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var l in e)if("default"!==l&&Object.prototype.hasOwnProperty.call(e,l)){var s=i?Object.getOwnPropertyDescriptor(e,l):null;s&&(s.get||s.set)?Object.defineProperty(n,l,s):n[l]=e[l]}n.default=e,a&&a.set(e,n);return n}(a("q1tI")),P=a("DtyJ"),v=a("ahDk"),D=n(a("wd/R")),y=a("T89o"),M=n(a("JUYq")),S=a("ifvJ"),j=a("dtw8"),O=a("Tq1+"),E=a("jtPO"),T=a("MfpC"),w=n(a("IAnr")),F=n(a("aTp4")),A=a("1YJs"),R=a("iP56"),k=n(a("WTKl")),_=n(a("w13Z")),C=n(a("Zc1O")),I=n(a("451q")),x=n(a("hLGy")),L=a("Loij"),B=n(a("NGW1")),N=n(a("EB+E")),W=a("Rw3A"),q=n(a("9hsD")),J=n(a("vOnD")),U=a("KLnl"),Y=n(a("M8tl"));function Z(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,a=new WeakMap;return(Z=function(e){return e?a:t})(e)}function $(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function G(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?$(Object(a),!0).forEach((function(t){(0,b.default)(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):$(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function K(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var a,n=(0,h.default)(e);if(t){var r=(0,h.default)(this).constructor;a=Reflect.construct(n,arguments,r)}else a=n.apply(this,arguments);return(0,m.default)(this,a)}}var z=J.default.form.withConfig({displayName:"edit__PhaseForm",componentId:"nul9yw-0"})([""]),Q=function(e){(0,p.default)(a,e);var t=K(a);function a(e){var n;return(0,d.default)(this,a),n=t.call(this,e),(0,b.default)((0,f.default)(n),"params$",void 0),(0,b.default)((0,f.default)(n),"subscriptions",void 0),(0,b.default)((0,f.default)(n),"handleTitleMultilocOnChange",(function(e){n.setState((function(t){return{submitState:"enabled",attributeDiff:G(G({},t.attributeDiff),{},{title_multiloc:e})}}))})),(0,b.default)((0,f.default)(n),"handleEditorOnChange",(function(e){n.setState((function(t){return{submitState:"enabled",attributeDiff:G(G({},t.attributeDiff),{},{description_multiloc:e})}}))})),(0,b.default)((0,f.default)(n),"handleIdeasDisplayChange",(function(e){n.setState((function(t){var a=t.attributeDiff;return{presentationMode:e,submitState:"enabled",attributeDiff:G(G({},a),{},{presentation_mode:e})}}))})),(0,b.default)((0,f.default)(n),"handleDateUpdate",(function(e){var t=e.startDate,a=e.endDate;n.setState((function(e){return{submitState:"enabled",attributeDiff:G(G({},e.attributeDiff),{},{start_at:t?t.locale("en").format("YYYY-MM-DD"):"",end_at:a?a.locale("en").format("YYYY-MM-DD"):""})}}))})),(0,b.default)((0,f.default)(n),"handlePhaseFileOnAdd",(function(e){n.setState((function(t){var a=t.phaseFiles.some((function(t){return t.base64===e.base64}));return{phaseFiles:a?t.phaseFiles:[].concat((0,o.default)(t.phaseFiles||[]),[e]),submitState:a?t.submitState:"enabled"}}))})),(0,b.default)((0,f.default)(n),"handlePhaseFileOnRemove",(function(e){n.setState((function(t){return{phaseFiles:t.phaseFiles.filter((function(t){return t.base64!==e.base64})),phaseFilesToRemove:[].concat((0,o.default)(t.phaseFilesToRemove||[]),[e]),submitState:"enabled"}}))})),(0,b.default)((0,f.default)(n),"handleOnSubmit",function(){var e=(0,u.default)(i.default.mark((function e(t){return i.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t.preventDefault(),w.default.emit("getParticipationContext");case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),(0,b.default)((0,f.default)(n),"getAttributeDiff",(function(e){return G(G({},n.state.attributeDiff),e)})),(0,b.default)((0,f.default)(n),"handleParticipationContextOnChange",(function(e){n.setState({submitState:"enabled",attributeDiff:n.getAttributeDiff(e)})})),(0,b.default)((0,f.default)(n),"handleParcticipationContextOnSubmit",(function(e){var t=n.state.phase,a=n.props.params.projectId,r=n.getAttributeDiff(e);n.save(a,t,r)})),(0,b.default)((0,f.default)(n),"save",function(){var e=(0,u.default)(i.default.mark((function e(t,a,r){var l,s,u,d,c,f,p,m;return i.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((0,y.isEmpty)(r)||n.state.processing){e.next=32;break}if(e.prev=1,l=n.state,s=l.phaseFiles,u=l.phaseFilesToRemove,d=a,c=!1,n.setState({processing:!0}),(0,y.isEmpty)(r)){e.next=19;break}if(!a){e.next=14;break}return e.next=10,(0,T.updatePhase)(a.data.id,r);case 10:d=e.sent,n.setState({attributeDiff:{}}),e.next=19;break;case 14:if(!t){e.next=19;break}return e.next=17,(0,T.addPhase)(t,r);case 17:d=e.sent,c=!0;case 19:if(!d){e.next=25;break}return f=d.data.id,p=s.filter((function(e){return!e.remote})).map((function(e){return(0,E.addPhaseFile)(f,e.base64,e.name)})),m=u.filter((function(e){return e.remote})).map((function(e){return(0,E.deletePhaseFile)(f,e.id)})),e.next=25,Promise.all([].concat((0,o.default)(p),(0,o.default)(m)));case 25:n.setState({phaseFilesToRemove:[],processing:!1,saved:!0,errors:null,submitState:"success"}),c&&M.default.push("/admin/projects/".concat(t,"/timeline/")),e.next=32;break;case 29:e.prev=29,e.t0=e.catch(1),n.setState({errors:(0,y.get)(e.t0,"json.errors",null),processing:!1,saved:!1,submitState:"error"});case 32:case"end":return e.stop()}}),e,null,[[1,29]])})));return function(t,a,n){return e.apply(this,arguments)}}()),(0,b.default)((0,f.default)(n),"quillMultilocLabel",g.default.createElement(W.FormattedMessage,q.default.descriptionLabel)),(0,b.default)((0,f.default)(n),"getStartDate",(function(){var e=n.state,t=e.phase,a=e.attributeDiff,r=n.props.phases,i=G(t?G({},t.data.attributes):{},a),l=null;if(t)i.start_at&&(l=(0,D.default)(i.start_at));else{var s=r&&r[r.length-1],u=s?(0,D.default)(s.attributes.end_at):null;u&&!i.start_at?l=u.add(1,"day"):i.start_at&&(l=(0,D.default)(i.start_at))}return l})),n.state={locale:null,phase:null,presentationMode:"card",attributeDiff:{},errors:null,processing:!1,saved:!1,loaded:!1,phaseFiles:[],phaseFilesToRemove:[],submitState:"disabled"},n.subscriptions=[],n.params$=new P.BehaviorSubject(null),n}return(0,c.default)(a,[{key:"componentDidMount",value:function(){var e=this,t=this.props.params,a=t.projectId,n=t.id;this.params$.next({projectId:a,id:n}),this.subscriptions=[this.params$.pipe((0,v.distinctUntilChanged)(F.default),(0,v.switchMap)((function(e){var t=e.id,a=(0,O.localeStream)().observable,n=t?(0,T.phaseStream)(t).observable:(0,P.of)(null);return(0,P.combineLatest)(a,n)}))).subscribe((function(t){var a=(0,s.default)(t,2),n=a[0],r=a[1];e.setState({locale:n,phase:r,loaded:!0})})),this.params$.pipe((0,v.distinctUntilChanged)(F.default),(0,v.switchMap)((function(e){return e.id?(0,E.phaseFilesStream)(e.id).observable.pipe((0,v.switchMap)((function(e){return e&&e.data&&e.data.length>0?(0,P.combineLatest)(e.data.map((function(e){var t=e.attributes.file.url,a=e.attributes.name,n=e.id;return(0,A.convertUrlToUploadFileObservable)(t,n,a)}))):(0,P.of)([])}))):(0,P.of)([])}))).subscribe((function(t){e.setState({phaseFiles:t.filter((function(e){return!(0,U.isNilOrError)(e)}))})}))]}},{key:"componentDidUpdate",value:function(){var e=this.props.params,t=e.projectId,a=e.id;this.params$.next({projectId:t,id:a})}},{key:"componentWillUnmount",value:function(){this.subscriptions.forEach((function(e){return e.unsubscribe()}))}},{key:"render",value:function(){if(this.state.loaded){var e=this.state,t=e.errors,a=e.phase,n=e.attributeDiff,r=e.processing,i=e.phaseFiles,l=e.submitState,s=G(a?G({},a.data.attributes):{},n),u=this.getStartDate(),o=s.end_at?(0,D.default)(s.end_at):null;return g.default.createElement(g.default.Fragment,null,g.default.createElement(L.SectionTitle,null,a&&g.default.createElement(W.FormattedMessage,q.default.editPhaseTitle),!a&&g.default.createElement(W.FormattedMessage,q.default.newPhaseTitle)),g.default.createElement(z,{onSubmit:this.handleOnSubmit},g.default.createElement(L.Section,null,g.default.createElement(L.SectionField,null,g.default.createElement(k.default,{id:"title",label:g.default.createElement(W.FormattedMessage,q.default.titleLabel),type:"text",valueMultiloc:s.title_multiloc,onChange:this.handleTitleMultilocOnChange}),g.default.createElement(C.default,{apiErrors:t&&t.title_multiloc})),g.default.createElement(L.SectionField,null,g.default.createElement(B.default,{phaseId:a?a.data.id:null,onSubmit:this.handleParcticipationContextOnSubmit,onChange:this.handleParticipationContextOnChange,apiErrors:t})),g.default.createElement(L.SectionField,null,g.default.createElement(R.Label,null,g.default.createElement(W.FormattedMessage,q.default.datesLabel)),g.default.createElement(I.default,{startDateId:"startDate",endDateId:"endDate",startDate:u,endDate:o,onDatesChange:this.handleDateUpdate}),g.default.createElement(C.default,{apiErrors:t&&t.start_at}),g.default.createElement(C.default,{apiErrors:t&&t.end_at})),g.default.createElement(L.SectionField,{className:"fullWidth"},g.default.createElement(_.default,{id:"description",label:this.quillMultilocLabel,valueMultiloc:s.description_multiloc,onChange:this.handleEditorOnChange,withCTAButton:!0}),g.default.createElement(C.default,{apiErrors:t&&t.description_multiloc})),g.default.createElement(L.SectionField,null,g.default.createElement(N.default,{onFileAdd:this.handlePhaseFileOnAdd,onFileRemove:this.handlePhaseFileOnRemove,files:i,errors:t})),t&&t.project&&g.default.createElement(L.SectionField,null,g.default.createElement(C.default,{apiErrors:t.project})),t&&t.base&&g.default.createElement(L.SectionField,null,g.default.createElement(C.default,{apiErrors:t.base}))),g.default.createElement(x.default,{loading:r,status:l,messages:{buttonSave:q.default.saveLabel,buttonSuccess:q.default.saveSuccessLabel,messageError:q.default.saveErrorMessage,messageSuccess:q.default.saveSuccessMessage}})))}return null}}]),a}(g.PureComponent),V=(0,W.injectIntl)(Q),X=(0,S.adopt)({phases:function(e){var t=e.params,a=e.render;return g.default.createElement(Y.default,{projectId:t.projectId},a)}}),H=(0,j.withRouter)((function(e){return g.default.createElement(X,e,(function(t){return g.default.createElement(V,(0,l.default)({},t,e))}))}));t.default=H},QAS3:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=(0,a("JRPe").defineMessages)({startDatePlaceholder:{id:"app.components.admin.DateRangePicker.startDatePlaceholder",defaultMessage:"Start Date"},endDatePlaceholder:{id:"app.components.admin.DateRangePicker.endDatePlaceholder",defaultMessage:"End Date"}});t.default=n}}]);
//# sourceMappingURL=51.79cfa89bfc5dd4d1c7f3.chunk.js.map